name: Integration Test in Tutor
description: "A Github action to test your plugin in Tutor (Open edX distribution)"
inputs:
  app_name:
    description: "Application name to test. E.g., eox-tenant."
    required: true
  tutor_version:
    description: "The tutor version matrix to use."
    required: true
  shell_file_to_run:
    description: "The path of the shell file to run the integration tests."
    required: false
  tests_path:
    description: "The path of the integration tests."
    required: false

runs:
  using: "composite"
  steps:
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Print current directory and files
      run: |
        pwd
        ls -la
      shell: bash

    - name: Prepare Tutor
      run: |
        pip install "tutor$INPUT_TUTOR_VERSION"
        # echo "TUTOR_PLUGINS_ROOT=$(pwd)/plugins/" >> "$GITHUB_ENV"
        # echo "TUTOR_ROOT=$(pwd)" >> "$GITHUB_ENV"
        which tutor
        tutor --version
        chmod 777 . -R
      shell: bash
      env:
        INPUT_APP: ${{ inputs.app_name }}
        INPUT_TUTOR_VERSION: ${{ inputs.tutor_version }}

    - name: Launch Tutor
      run: |
        tutor local launch --non-interactive
      shell: bash

    - name: Curl Heartbeat
      run: |
        curl -s http://local.edly.io/heartbeat
      shell: bash

    # - name: Run bash script
    #   if: ${{ inputs.shell_file_to_run }}
    #   run: |
    #     TUTOR_ROOT="$(pwd)" tutor local run lms bash $INPUT_SHELL_FILE
    #   shell: bash
    #   env:
    #     INPUT_SHELL_FILE: /openedx/${{ inputs.app_name }}/${{ inputs.shell_file_to_run }}

    # - name: Run integration tests
    #   run: |
    #     cd $(pwd)/$INPUT_APP
    #     make install-dev-dependencies
    #     pytest $TEST_PATH
    #   shell: bash
    #   env:
    #     INPUT_APP: ${{ inputs.app_name }}
    #     TEST_PATH: ${{ inputs.tests_path }}
